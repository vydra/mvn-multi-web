# Note that all packages and scripts will be installed/run in their order of appearance.
# Please look at our documentation page for more information. You can find it at https://koalitycode.com/documentation?view=yaml

languages:
  jvm: 1.6
setup:
- packages:
  - system:

# Defines databases used for your tests. They are local to the VMs the tests are run on.
# Currently, only postgres and mysql are supported. This configuration includes both.
- databases:
  - mysql:
    - name: test_db
      username: test_user
  - postgres:
    - name: test_db
      username: test_user

# Arbitrary scripts to run that were not covered earlier.
- scripts:

# The following section defines how to build your code. Each section can be given an arbitrary name.


compile:
  scripts:
  - mvn compile 0:
      script: mvn compile
  - mvn compile 1:
      path: simple-parent/simple-webapp
      script: mvn compile
  - mvn compile 2:
      path: simple-parent
      script: mvn compile
  - mvn compile 3:
      path: simple-parent/simple-model
      script: mvn compile
  - mvn compile 4:
      path: simple-parent/simple-weather
      script: mvn compile
  - mvn compile 5:
      path: simple-parent/simple-command
      script: mvn compile
  - mvn compile 6:
      path: simple-parent/simple-persist
      script: mvn compile
 
#### Delete the above compile section to use the generated compile section ####


# Defines how to parallelize and run your tests. All commands from here on will be executed in parallel.
# NOTE: Scripts that do batch testing will not be parallelized.
test:
# Factory scripts that will output test scripts to be run in parallel.

# Following this is our inferred guess as to what your factory section should look like.
#################################################################
#  factories:
#  - factory .:
#      path: .
#      script:
#      - "find . -name \"*[tT]est*.java\" | sed \"s/.*\\/\\(.*\\).java/\\1/\" | while\
#        \ read java; do echo -e \"- mvn -Dtest=$java test:\n    path: .\"; done"
#  - factory simple-parent/simple-webapp:
#      path: simple-parent/simple-webapp
#      script:
#      - "find . -name \"*[tT]est*.java\" | sed \"s/.*\\/\\(.*\\).java/\\1/\" | while\
#        \ read java; do echo -e \"- mvn -Dtest=$java test:\n    path: simple-parent/simple-webapp\"\
#        ; done"
#  - factory simple-parent:
#      path: simple-parent
#      script:
#      - "find . -name \"*[tT]est*.java\" | sed \"s/.*\\/\\(.*\\).java/\\1/\" | while\
#        \ read java; do echo -e \"- mvn -Dtest=$java test:\n    path: simple-parent\"\
#        ; done"
#  - factory simple-parent/simple-model:
#      path: simple-parent/simple-model
#      script:
#      - "find . -name \"*[tT]est*.java\" | sed \"s/.*\\/\\(.*\\).java/\\1/\" | while\
#        \ read java; do echo -e \"- mvn -Dtest=$java test:\n    path: simple-parent/simple-model\"\
#        ; done"
#  - factory simple-parent/simple-weather:
#      path: simple-parent/simple-weather
#      script:
#      - "find . -name \"*[tT]est*.java\" | sed \"s/.*\\/\\(.*\\).java/\\1/\" | while\
#        \ read java; do echo -e \"- mvn -Dtest=$java test:\n    path: simple-parent/simple-weather\"\
#        ; done"
#  - factory simple-parent/simple-command:
#      path: simple-parent/simple-command
#      script:
#      - "find . -name \"*[tT]est*.java\" | sed \"s/.*\\/\\(.*\\).java/\\1/\" | while\
#        \ read java; do echo -e \"- mvn -Dtest=$java test:\n    path: simple-parent/simple-command\"\
#        ; done"
#  - factory simple-parent/simple-persist:
#      path: simple-parent/simple-persist
#      script:
#      - "find . -name \"*[tT]est*.java\" | sed \"s/.*\\/\\(.*\\).java/\\1/\" | while\
#        \ read java; do echo -e \"- mvn -Dtest=$java test:\n    path: simple-parent/simple-persist\"\
#        ; done"
#  
#################################################################
  factories:
  - factory template:
      path: simple-parent/simple-command
      script:
      - "find . -name \"*[tT]est*.java\" | sed \"s/.*\\/\\(.*\\).java/\\1/\" | while\
        \ read java; do echo -e \"- mvn -Dtest=$java test:\n    path: simple-parent/simple-command\"\
        ; done" 

  machines: 2

  scripts:
  - test script template:
      path: .
      script:
      - "false \"\n\n\e[1;31mThis is an autogenerated template\n\e[0mYou need to complete this section with a test script (if necessary)\n\e[0mEach manually entered test script is a parallelizable unit\n\
        \e[0mDocumentation on test scripts can be found at https://koalitycode.com/documentation?view=yamlTest\n\n\""
      timeout: 10

